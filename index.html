<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ููุงุญุธุงุชู - ูููุน ุงูููุงุญุธุงุช ุงููุชูุงูู</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>๐</text></svg>">
</head>
<body class="light-mode">
    <div id="loader" class="loader">
        <div class="loader-content">
            <div class="loader-spinner"></div>
            <p>ุฌุงุฑู ุงูุชุญููู...</p>
        </div>
    </div>

    <div id="authSection" class="auth-section">
        <div class="auth-container">
            <div class="auth-header">
                <h2>ูุฑุญุจุงู ุจุนูุฏุชู!</h2>
                <p>ุณุฌู ุงูุฏุฎูู ูููุตูู ุฅูู ููุงุญุธุงุชู</p>
            </div>
            <div class="auth-form">
                <div class="input-group">
                    <label for="usernameInput">ุงุณู ุงููุณุชุฎุฏู</label>
                    <input type="text" id="usernameInput" placeholder="ุฃุฏุฎู ุงุณู ุงููุณุชุฎุฏู">
                    <i class="fas fa-user"></i>
                </div>
                <div class="input-group">
                    <label for="passwordInput">ูููุฉ ุงููุฑูุฑ</label>
                    <input type="password" id="passwordInput" placeholder="ุฃุฏุฎู ูููุฉ ุงููุฑูุฑ">
                    <i class="fas fa-lock"></i>
                </div>
                <button id="loginBtn" class="btn btn-primary">
                    <i class="fas fa-sign-in-alt"></i> ุชุณุฌูู ุงูุฏุฎูู
                </button>
                <button id="registerBtn" class="btn btn-secondary">
                    <i class="fas fa-user-plus"></i> ุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ
                </button>
                <p id="authMessage" class="auth-message"></p>
            </div>
            <div class="auth-footer">
                <button id="toggleThemeBtn" class="theme-toggle">
                    <i class="fas fa-moon"></i> ุงููุถุน ุงููุธูู
                </button>
            </div>
        </div>
    </div>

    <div id="appSection" class="container" style="display: none;">
        <div class="app-header">
            <div class="header-left">
                <button id="sidebarToggle" class="btn btn-icon">
                    <i class="fas fa-bars"></i>
                </button>
                <h1><i class="fas fa-book-open"></i> ููุงุญุธุงุชู</h1>
            </div>
            <div class="header-right">
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="ุงุจุญุซ ูู ุงูููุงุญุธุงุช...">
                    <i class="fas fa-search"></i>
                </div>
                <div class="user-actions">
                    <button id="toggleThemeBtn2" class="btn btn-icon" title="ุชุจุฏูู ุงููุถุน">
                        <i class="fas fa-moon"></i>
                    </button>
                    <div class="user-dropdown">
                        <button id="userDropdownBtn" class="btn btn-icon">
                            <i class="fas fa-user-circle"></i>
                        </button>
                        <div id="userDropdownMenu" class="dropdown-menu">
                            <div class="dropdown-header">
                                <i class="fas fa-user-circle"></i>
                                <span id="currentUsername"></span>
                            </div>
                            <button id="logoutBtn" class="dropdown-item">
                                <i class="fas fa-sign-out-alt"></i> ุชุณุฌูู ุงูุฎุฑูุฌ
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="app-container">
            <div id="sidebar" class="sidebar">
                <div class="sidebar-menu">
                    <button class="sidebar-item active" data-category="ุงููู">
                        <i class="fas fa-home"></i> ุงูุฑุฆูุณูุฉ
                    </button>
                    <button class="sidebar-item" data-category="ุนุงู">
                        <i class="fas fa-sticky-note"></i> ููุงุญุธุงุช ุนุงูุฉ
                    </button>
                    <button class="sidebar-item" data-category="ุนูู">
                        <i class="fas fa-briefcase"></i> ุงูุนูู
                    </button>
                    <button class="sidebar-item" data-category="ุฏุฑุงุณุฉ">
                        <i class="fas fa-graduation-cap"></i> ุงูุฏุฑุงุณุฉ
                    </button>
                    <button class="sidebar-item" data-category="ุฃููุงุฑ">
                        <i class="fas fa-lightbulb"></i> ุฃููุงุฑ
                    </button>
                    <button class="sidebar-item" data-category="ููู">
                        <i class="fas fa-star"></i> ุงูููู
                    </button>
                </div>
                <div class="sidebar-footer">
                    <button id="newNoteBtn" class="btn btn-primary btn-block">
                        <i class="fas fa-plus"></i> ููุงุญุธุฉ ุฌุฏูุฏุฉ
                    </button>
                </div>
            </div>

            <div class="main-content">
                <div class="notes-actions">
                    <div class="filter-controls">
                        <div class="filter-group">
                            <label>ุชุฑุชูุจ ุญุณุจ:</label>
                            <select id="sortBy">
                                <option value="newest">ุงูุฃุญุฏุซ ุฃููุงู</option>
                                <option value="oldest">ุงูุฃูุฏู ุฃููุงู</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>ุชุตููุฉ:</label>
                            <select id="filterCategory">
                                <option value="ุงููู">ุงููู</option>
                                <option value="ุนุงู">ุนุงู</option>
                                <option value="ุนูู">ุนูู</option>
                                <option value="ุฏุฑุงุณุฉ">ุฏุฑุงุณุฉ</option>
                                <option value="ุฃููุงุฑ">ุฃููุงุฑ</option>
                                <option value="ููู">ููู</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label class="checkbox-container">
                                <input type="checkbox" id="importantOnly"> ุงูููู ููุท
                                <span class="checkmark"></span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="notes-grid" id="notesDisplay"></div>

                <div id="emptyState" class="empty-state">
                    <i class="fas fa-book-open"></i>
                    <h3>ูุง ุชูุฌุฏ ููุงุญุธุงุช ูุนุฑุถูุง</h3>
                    <p>ุงุจุฏุฃ ุจุฅุถุงูุฉ ููุงุญุธุฉ ุฌุฏูุฏุฉ ุจุงูุถุบุท ุนูู ุงูุฒุฑ ุจุงูุฃุนูู</p>
                    <button id="emptyStateNewNoteBtn" class="btn btn-primary">
                        <i class="fas fa-plus"></i> ุฅูุดุงุก ููุงุญุธุฉ ุฌุฏูุฏุฉ
                    </button>
                </div>
            </div>
        </div>

        <div class="note-editor" id="noteEditor">
            <div class="editor-header">
                <h3 id="editorTitle">ููุงุญุธุฉ ุฌุฏูุฏุฉ</h3>
                <button id="closeEditorBtn" class="btn btn-icon">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="editor-body">
                <textarea id="noteInput" placeholder="ุงูุชุจ ููุงุญุธุชู ููุง..."></textarea>
                <div class="editor-footer">
                    <div class="editor-actions">
                        <select id="noteCategory">
                            <option value="ุนุงู">ุนุงู</option>
                            <option value="ุนูู">ุนูู</option>
                            <option value="ุฏุฑุงุณุฉ">ุฏุฑุงุณุฉ</option>
                            <option value="ุฃููุงุฑ">ุฃููุงุฑ</option>
                            <option value="ููู">ููู</option>
                        </select>
                        <div class="file-upload">
                            <label for="fileInput" class="btn btn-secondary">
                                <i class="fas fa-paperclip"></i> ุฅุฑูุงู ููู
                                <input type="file" id="fileInput" style="display: none;">
                            </label>
                            <span id="fileName"></span>
                        </div>
                    </div>
                    <div class="editor-buttons">
                        <button id="cancelNoteBtn" class="btn btn-secondary">ุฅูุบุงุก</button>
                        <button id="saveNoteBtn" class="btn btn-primary">ุญูุธ ุงูููุงุญุธุฉ</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="alertContainer"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
    // =====================
    // ุชุนุฑูู ุงูุนูุงุตุฑ
    // =====================
    const loader = document.getElementById('loader');
    const authSection = document.getElementById('authSection');
    const appSection = document.getElementById('appSection');
    const usernameInput = document.getElementById('usernameInput');
    const passwordInput = document.getElementById('passwordInput');
    const loginBtn = document.getElementById('loginBtn');
    const registerBtn = document.getElementById('registerBtn');
    const authMessage = document.getElementById('authMessage');
    const logoutBtn = document.getElementById('logoutBtn');
    const currentUsername = document.getElementById('currentUsername');
    const toggleThemeBtn = document.getElementById('toggleThemeBtn');
    const toggleThemeBtn2 = document.getElementById('toggleThemeBtn2');
    const sidebarToggle = document.getElementById('sidebarToggle');
    const sidebar = document.getElementById('sidebar');
    const userDropdownBtn = document.getElementById('userDropdownBtn');
    const userDropdownMenu = document.getElementById('userDropdownMenu');
    const newNoteBtn = document.getElementById('newNoteBtn');
    const emptyStateNewNoteBtn = document.getElementById('emptyStateNewNoteBtn');
    const noteEditor = document.getElementById('noteEditor');
    const editorTitle = document.getElementById('editorTitle');
    const noteInput = document.getElementById('noteInput');
    const saveNoteBtn = document.getElementById('saveNoteBtn');
    const cancelNoteBtn = document.getElementById('cancelNoteBtn');
    const closeEditorBtn = document.getElementById('closeEditorBtn');
    const noteCategory = document.getElementById('noteCategory');
    const fileInput = document.getElementById('fileInput');
    const fileName = document.getElementById('fileName');
    const notesDisplay = document.getElementById('notesDisplay');
    const emptyState = document.getElementById('emptyState');
    const filterCategory = document.getElementById('filterCategory');
    const sortBy = document.getElementById('sortBy');
    const importantOnly = document.getElementById('importantOnly');
    const searchInput = document.getElementById('searchInput');
    const sidebarItems = document.querySelectorAll('.sidebar-item');
    const alertContainer = document.getElementById('alertContainer');

    // =====================
    // ุจูุงูุงุช ุงูุชุทุจูู
    // =====================
    let users = JSON.parse(localStorage.getItem('noteAppUsers')) || [];
    let notes = JSON.parse(localStorage.getItem('noteAppNotes')) || [];
    let currentUser = null;
    let currentNoteId = null;
    let currentFile = null;
    let isDarkMode = localStorage.getItem('noteAppDarkMode') === 'true';

    // =====================
    // ุชููุฆุฉ ุงูุชุทุจูู
    // =====================
    init();

    function init() {
        // ุชุญููู ุงูุจูุงูุงุช
        loadData();

        // ุชุทุจูู ูุถุน ุงูุฃููุงู
        applyTheme();

        // ุงูุชุญูู ูู ูุฌูุฏ ูุณุชุฎุฏู ูุณุฌู ุงูุฏุฎูู
        const loggedInUser = localStorage.getItem('noteAppCurrentUser');
        if (loggedInUser) {
            currentUser = JSON.parse(loggedInUser);
            showApp();
        } else {
            showAuth();
        }

        // ุฅุฎูุงุก loader ุจุนุฏ ุชุญููู ุงูุตูุญุฉ
        setTimeout(() => {
            loader.style.opacity = '0';
            setTimeout(() => {
                loader.style.display = 'none';
            }, 300);
        }, 500);
    }

    function loadData() {
        const savedUsers = localStorage.getItem('noteAppUsers');
        const savedNotes = localStorage.getItem('noteAppNotes');
        
        if (savedUsers) users = JSON.parse(savedUsers);
        if (savedNotes) notes = JSON.parse(savedNotes);
    }

    function saveData() {
        localStorage.setItem('noteAppUsers', JSON.stringify(users));
        localStorage.setItem('noteAppNotes', JSON.stringify(notes));
    }

    function showAuth() {
        authSection.style.display = 'flex';
        appSection.style.display = 'none';
    }

    function showApp() {
        authSection.style.display = 'none';
        appSection.style.display = 'block';
        currentUsername.textContent = currentUser.username;
        displayNotes();
    }

    // =====================
    // ุฅุฏุงุฑุฉ ุงููุถุน ุงููุธูู
    // =====================
    function applyTheme() {
        if (isDarkMode) {
            document.body.classList.add('dark-mode');
            toggleThemeBtn.innerHTML = '<i class="fas fa-sun"></i> ุงููุถุน ุงููุงุชุญ';
            toggleThemeBtn2.innerHTML = '<i class="fas fa-sun"></i>';
        } else {
            document.body.classList.remove('dark-mode');
            toggleThemeBtn.innerHTML = '<i class="fas fa-moon"></i> ุงููุถุน ุงููุธูู';
            toggleThemeBtn2.innerHTML = '<i class="fas fa-moon"></i>';
        }
    }

    function toggleTheme() {
        isDarkMode = !isDarkMode;
        localStorage.setItem('noteAppDarkMode', isDarkMode);
        applyTheme();
    }

    // =====================
    // ุฅุฏุงุฑุฉ ุงูููุงุญุธุงุช
    // =====================
    function displayNotes() {
        const categoryFilter = filterCategory.value;
        const searchTerm = searchInput.value.toLowerCase();
        const showImportantOnly = importantOnly.checked;
        const sortOrder = sortBy.value;

        let filteredNotes = notes.filter(note => note.userId === currentUser.id);

        // ุชุตููุฉ ุญุณุจ ุงููุฆุฉ
        if (categoryFilter !== 'ุงููู') {
            filteredNotes = filteredNotes.filter(note => note.category === categoryFilter);
        }

        // ุชุตููุฉ ุญุณุจ ุงูุจุญุซ
        if (searchTerm) {
            filteredNotes = filteredNotes.filter(note => 
                note.content.toLowerCase().includes(searchTerm) ||
                (note.fileName && note.fileName.toLowerCase().includes(searchTerm))
            );
        }

        // ุชุตููุฉ ุญุณุจ ุงูุฃูููุฉ
        if (showImportantOnly) {
            filteredNotes = filteredNotes.filter(note => note.category === 'ููู');
        }

        // ุชุฑุชูุจ ุงูููุงุญุธุงุช
        if (sortOrder === 'newest') {
            filteredNotes.sort((a, b) => new Date(b.date) - new Date(a.date));
        } else {
            filteredNotes.sort((a, b) => new Date(a.date) - new Date(b.date));
        }

        // ุนุฑุถ ุงูููุงุญุธุงุช
        notesDisplay.innerHTML = '';

        if (filteredNotes.length === 0) {
            emptyState.style.display = 'flex';
        } else {
            emptyState.style.display = 'none';
            filteredNotes.forEach(note => {
                const noteElement = document.createElement('div');
                noteElement.className = `note-card ${note.category.toLowerCase()}`;
                
                let attachmentHtml = '';
                if (note.fileName) {
                    attachmentHtml = `
                        <div class="attachment">
                            <a href="#" data-file="${note.fileName}" class="download-file">
                                <i class="fas fa-paperclip"></i> ${note.fileName}
                            </a>
                        </div>
                    `;
                }

                noteElement.innerHTML = `
                    <div class="note-actions">
                        <button class="edit-btn" data-id="${note.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="delete-btn" data-id="${note.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                        ${note.category !== 'ููู' ? 
                            `<button class="important-btn" data-id="${note.id}">
                                <i class="fas fa-star"></i>
                            </button>` : ''}
                    </div>
                    <div class="note-content">${note.content}</div>
                    ${attachmentHtml}
                    <div class="note-meta">
                        <span class="note-category">${note.category}</span>
                        <span class="note-date">${formatDate(note.date)}</span>
                    </div>
                `;
                notesDisplay.appendChild(noteElement);
            });
        }

        // ุฅุถุงูุฉ ุงูุฃุญุฏุงุซ
        addNoteEvents();
    }

    function formatDate(dateString) {
        const options = { 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric', 
            hour: '2-digit', 
            minute: '2-digit',
            hour12: true
        };
        return new Date(dateString).toLocaleDateString('ar-EG', options);
    }

    function addNoteEvents() {
        // ุญุฐู ุงูููุงุญุธุฉ
        document.querySelectorAll('.delete-btn').forEach(button => {
            button.addEventListener('click', function() {
                const noteId = parseInt(this.getAttribute('data-id'));
                deleteNote(noteId);
            });
        });

        // ุชุนุฏูู ุงูููุงุญุธุฉ
        document.querySelectorAll('.edit-btn').forEach(button => {
            button.addEventListener('click', function() {
                const noteId = parseInt(this.getAttribute('data-id'));
                editNote(noteId);
            });
        });

        // ุชุญุฏูุฏ ูููุงุญุธุฉ ูููุฉ
        document.querySelectorAll('.important-btn').forEach(button => {
            button.addEventListener('click', function() {
                const noteId = parseInt(this.getAttribute('data-id'));
                markAsImportant(noteId);
            });
        });

        // ุชุญููู ุงูููู ุงููุฑูู
        document.querySelectorAll('.download-file').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const fileName = this.getAttribute('data-file');
                showAlert('ูุง ูููู ุชูุฒูู ุงููููุงุช ูู ูุฐุง ุงูุฅุตุฏุงุฑ', 'info');
            });
        });
    }

    function openEditor(mode, noteId = null) {
        currentNoteId = noteId;
        
        if (mode === 'add') {
            editorTitle.textContent = 'ููุงุญุธุฉ ุฌุฏูุฏุฉ';
            noteInput.value = '';
            noteCategory.value = 'ุนุงู';
            fileName.textContent = '';
            currentFile = null;
        } else if (mode === 'edit') {
            const note = notes.find(n => n.id === noteId);
            if (note) {
                editorTitle.textContent = 'ุชุนุฏูู ุงูููุงุญุธุฉ';
                noteInput.value = note.content;
                noteCategory.value = note.category;
                fileName.textContent = note.fileName || '';
                currentFile = note.fileName ? { name: note.fileName } : null;
            }
        }
        
        noteEditor.classList.add('open');
        
        // ุถุจุท ุงุฑุชูุงุน ุงููุญุฑุฑ ูููุงุชู
        if (isMobileDevice()) {
            adjustEditorHeight();
            
            // ุชุฃุฎูุฑ ุงูุชุฑููุฒ ุญุชู ููุชูู ูุชุญ ุงููุญุฑุฑ
            setTimeout(() => {
                noteInput.focus();
                
                // ุชุญุฑูู ุงูุดุงุดุฉ ููุฃุนูู ูุฑุคูุฉ ุงููุญุฑุฑ
                window.scrollTo({
                    top: document.body.scrollHeight,
                    behavior: 'smooth'
                });
            }, 300);
        } else {
            noteInput.focus();
        }
    }

    function closeEditor() {
        noteEditor.classList.remove('open');
    }

    function saveNote() {
        const content = noteInput.value.trim();
        const category = noteCategory.value;
        
        if (!content) {
            showAlert('ุงูุฑุฌุงุก ุฅุฏุฎุงู ูุญุชูู ููููุงุญุธุฉ', 'error');
            return;
        }

        if (currentNoteId) {
            // ุชุนุฏูู ููุงุญุธุฉ ููุฌูุฏุฉ
            const noteIndex = notes.findIndex(n => n.id === currentNoteId);
            if (noteIndex !== -1) {
                notes[noteIndex].content = content;
                notes[noteIndex].category = category;
                notes[noteIndex].fileName = currentFile ? currentFile.name : null;
                showAlert('ุชู ุชุนุฏูู ุงูููุงุญุธุฉ ุจูุฌุงุญ', 'success');
            }
        } else {
            // ุฅุถุงูุฉ ููุงุญุธุฉ ุฌุฏูุฏุฉ
            const newNote = {
                id: Date.now(),
                userId: currentUser.id,
                content: content,
                category: category,
                date: new Date().toISOString(),
                fileName: currentFile ? currentFile.name : null
            };
            
            notes.unshift(newNote);
            showAlert('ุชูุช ุฅุถุงูุฉ ุงูููุงุญุธุฉ ุจูุฌุงุญ', 'success');
        }
        
        saveData();
        displayNotes();
        closeEditor();
    }

    function deleteNote(id) {
        if (confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐู ุงูููุงุญุธุฉุ')) {
            notes = notes.filter(note => note.id !== id);
            saveData();
            displayNotes();
            showAlert('ุชู ุญุฐู ุงูููุงุญุธุฉ ุจูุฌุงุญ', 'success');
        }
    }

    function editNote(id) {
        openEditor('edit', id);
    }

    function markAsImportant(id) {
        const noteIndex = notes.findIndex(n => n.id === id);
        if (noteIndex !== -1) {
            notes[noteIndex].category = 'ููู';
            saveData();
            displayNotes();
            showAlert('ุชู ุชุญุฏูุฏ ุงูููุงุญุธุฉ ููููุฉ', 'success');
        }
    }

    // =====================
    // ุฅุฏุงุฑุฉ ุงููููุงุช ุงููุฑููุฉ
    // =====================
    fileInput.addEventListener('change', function() {
        if (this.files.length > 0) {
            currentFile = this.files[0];
            fileName.textContent = currentFile.name;
            showAlert('ุชู ุฅุฑูุงู ุงูููู ุจูุฌุงุญ', 'success');
        }
    });

    // =====================
    // ูุธุงู ุงูุชูุจููุงุช
    // =====================
    function showAlert(message, type) {
        const alert = document.createElement('div');
        alert.className = `alert alert-${type}`;
        alert.innerHTML = `
            <i class="fas ${type === 'success' ? 'fa-check-circle' : 
                          type === 'error' ? 'fa-exclamation-circle' : 
                          type === 'warning' ? 'fa-exclamation-triangle' : 'fa-info-circle'}"></i>
            ${message}
        `;
        
        alertContainer.appendChild(alert);
        
        // ุฅุฒุงูุฉ ุงูุชูุจูู ุจุนุฏ 3 ุซูุงูู
        setTimeout(() => {
            alert.remove();
        }, 3000);
    }

    // =====================
    // ูุธุงู ุงููุตุงุฏูุฉ
    // =====================
    function login() {
        const username = usernameInput.value.trim();
        const password = passwordInput.value.trim();
        
        if (!username || !password) {
            authMessage.textContent = 'ุงูุฑุฌุงุก ุฅุฏุฎุงู ุงุณู ุงููุณุชุฎุฏู ููููุฉ ุงููุฑูุฑ';
            return;
        }

        const user = users.find(u => u.username === username && u.password === password);
        if (user) {
            currentUser = user;
            localStorage.setItem('noteAppCurrentUser', JSON.stringify(user));
            showApp();
            showAlert(`ูุฑุญุจุงู ${username}!`, 'success');
            usernameInput.value = '';
            passwordInput.value = '';
            authMessage.textContent = '';
        } else {
            authMessage.textContent = 'ุงุณู ุงููุณุชุฎุฏู ุฃู ูููุฉ ุงููุฑูุฑ ุบูุฑ ุตุญูุญุฉ';
        }
    }

    function register() {
        const username = usernameInput.value.trim();
        const password = passwordInput.value.trim();
        
        if (!username || !password) {
            authMessage.textContent = 'ุงูุฑุฌุงุก ุฅุฏุฎุงู ุงุณู ุงููุณุชุฎุฏู ููููุฉ ุงููุฑูุฑ';
            return;
        }

        const userExists = users.some(u => u.username === username);
        if (userExists) {
            authMessage.textContent = 'ุงุณู ุงููุณุชุฎุฏู ููุฌูุฏ ูุณุจูุงู';
        } else {
            const newUser = {
                id: Date.now(),
                username: username,
                password: password
            };
            
            users.push(newUser);
            saveData();
            authMessage.textContent = 'ุชู ุฅูุดุงุก ุงูุญุณุงุจ ุจูุฌุงุญ! ููููู ุชุณุฌูู ุงูุฏุฎูู ุงูุขู';
            showAlert('ุชู ุฅูุดุงุก ุงูุญุณุงุจ ุจูุฌุงุญ!', 'success');
        }
    }

    function logout() {
        currentUser = null;
        localStorage.removeItem('noteAppCurrentUser');
        showAuth();
        showAlert('ุชู ุชุณุฌูู ุงูุฎุฑูุฌ ุจูุฌุงุญ', 'success');
    }

    // =====================
    // ูุธุงุฆู ูุณุงุนุฏุฉ
    // =====================
    function isMobileDevice() {
        return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    }

    function adjustEditorHeight() {
        const windowHeight = window.innerHeight;
        const editorMaxHeight = Math.floor(windowHeight * 0.7);
        noteEditor.style.maxHeight = `${editorMaxHeight}px`;
    }

    // =====================
    // ุงูุฃุญุฏุงุซ
    // =====================
    // ุชุจุฏูู ุงููุถุน ุงููุธูู
    toggleThemeBtn.addEventListener('click', toggleTheme);
    toggleThemeBtn2.addEventListener('click', toggleTheme);

    // ุชุณุฌูู ุงูุฏุฎูู ูุงูุชุณุฌูู
    loginBtn.addEventListener('click', login);
    registerBtn.addEventListener('click', register);
    logoutBtn.addEventListener('click', logout);

    // ุฅุฏุงุฑุฉ ุงูููุงุญุธุงุช
    newNoteBtn.addEventListener('click', () => openEditor('add'));
    emptyStateNewNoteBtn.addEventListener('click', () => openEditor('add'));
    saveNoteBtn.addEventListener('click', saveNote);
    cancelNoteBtn.addEventListener('click', closeEditor);
    closeEditorBtn.addEventListener('click', closeEditor);

    // ุชุตููุฉ ูุชุฑุชูุจ ุงูููุงุญุธุงุช
    filterCategory.addEventListener('change', displayNotes);
    sortBy.addEventListener('change', displayNotes);
    importantOnly.addEventListener('change', displayNotes);
    searchInput.addEventListener('input', displayNotes);

    // ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ
    sidebarToggle.addEventListener('click', () => {
        sidebar.classList.toggle('open');
    });

    sidebarItems.forEach(item => {
        item.addEventListener('click', () => {
            sidebarItems.forEach(i => i.classList.remove('active'));
            item.classList.add('active');
            filterCategory.value = item.getAttribute('data-category');
            displayNotes();
            
            // ุฅุบูุงู ุงูุดุฑูุท ุงูุฌุงูุจู ุนูู ุงูููุงุชู
            if (isMobileDevice()) {
                sidebar.classList.remove('open');
            }
        });
    });

    // ุงููุงุฆูุฉ ุงูููุณุฏูุฉ ูููุณุชุฎุฏู
    userDropdownBtn.addEventListener('click', () => {
        userDropdownMenu.style.display = userDropdownMenu.style.display === 'block' ? 'none' : 'block';
    });

    // ุฅุบูุงู ุงูููุงุฆู ุงูููุณุฏูุฉ ุนูุฏ ุงูููุฑ ุฎุงุฑุฌูุง
    window.addEventListener('click', (e) => {
        if (!e.target.matches('#userDropdownBtn') && !e.target.closest('#userDropdownMenu')) {
            if (userDropdownMenu.style.display === 'block') {
                userDropdownMenu.style.display = 'none';
            }
        }
        
        if (e.target === noteEditor) {
            closeEditor();
        }
    });

    // ุฅุถุงูุฉ ูุณุชุฎุฏู ุงูุชุฑุงุถู ููุงุฎุชุจุงุฑ ุฅุฐุง ูู ููู ููุงู ูุณุชุฎุฏููู
    if (users.length === 0) {
        users.push({
            id: 1,
            username: 'test',
            password: 'test123'
        });
        saveData();
    }

    // ุชุญุณูู ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู: ุฅุบูุงู ุงููุญุฑุฑ ุจุงูุฒุฑ ESC
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && noteEditor.classList.contains('open')) {
            closeEditor();
        }
    });

    // ุถุจุท ุงูุงุฑุชูุงุน ุงูุฃููู ูููุญุฑุฑ ุนูู ุงูููุงุชู
    if (isMobileDevice()) {
        adjustEditorHeight();
    }

    // ุฅุนุงุฏุฉ ุถุจุท ุงุฑุชูุงุน ุงููุญุฑุฑ ุนูุฏ ุชุบููุฑ ุญุฌู ุงููุงูุฐุฉ
    window.addEventListener('resize', function() {
        if (isMobileDevice() && noteEditor.classList.contains('open')) {
            adjustEditorHeight();
        }
    });
});
    </script>
</body>
</html>
