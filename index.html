<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙŠ - Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ“</text></svg>">
</head>
<body class="light-mode">
    <div id="loader" class="loader">
        <div class="loader-content">
            <div class="loader-spinner"></div>
            <p>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
        </div>
    </div>

    <div id="authSection" class="auth-section">
        <div class="auth-container">
            <div class="auth-header">
                <h2>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ø¹ÙˆØ¯ØªÙƒ!</h2>
                <p>Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ</p>
            </div>
            <div class="auth-form">
                <div class="input-group">
                    <label for="usernameInput">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                    <input type="text" id="usernameInput" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
                    <i class="fas fa-user"></i>
                </div>
                <div class="input-group">
                    <label for="passwordInput">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                    <input type="password" id="passwordInput" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
                    <i class="fas fa-lock"></i>
                </div>
                <button id="loginBtn" class="btn btn-primary">
                    <i class="fas fa-sign-in-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                </button>
                <button id="registerBtn" class="btn btn-secondary">
                    <i class="fas fa-user-plus"></i> Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
                </button>
                <p id="authMessage" class="auth-message"></p>
            </div>
            <div class="auth-footer">
                <button id="toggleThemeBtn" class="theme-toggle">
                    <i class="fas fa-moon"></i> Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¸Ù„Ù…
                </button>
            </div>
        </div>
    </div>

    <div id="appSection" class="container" style="display: none;">
        <div class="app-header">
            <div class="header-left">
                <button id="sidebarToggle" class="btn btn-icon">
                    <i class="fas fa-bars"></i>
                </button>
                <h1><i class="fas fa-book-open"></i> Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙŠ</h1>
            </div>
            <div class="header-right">
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª...">
                    <i class="fas fa-search"></i>
                </div>
                <div class="user-actions">
                    <button id="toggleThemeBtn2" class="btn btn-icon" title="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹">
                        <i class="fas fa-moon"></i>
                    </button>
                    <div class="user-dropdown">
                        <button id="userDropdownBtn" class="btn btn-icon">
                            <i class="fas fa-user-circle"></i>
                        </button>
                        <div id="userDropdownMenu" class="dropdown-menu">
                            <div class="dropdown-header">
                                <i class="fas fa-user-circle"></i>
                                <span id="currentUsername"></span>
                            </div>
                            <button id="logoutBtn" class="dropdown-item">
                                <i class="fas fa-sign-out-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="app-container">
            <div id="sidebar" class="sidebar">
                <div class="sidebar-menu">
                    <button class="sidebar-item active" data-category="Ø§Ù„ÙƒÙ„">
                        <i class="fas fa-home"></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                    </button>
                    <button class="sidebar-item" data-category="Ø¹Ø§Ù…">
                        <i class="fas fa-sticky-note"></i> Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¹Ø§Ù…Ø©
                    </button>
                    <button class="sidebar-item" data-category="Ø¹Ù…Ù„">
                        <i class="fas fa-briefcase"></i> Ø§Ù„Ø¹Ù…Ù„
                    </button>
                    <button class="sidebar-item" data-category="Ø¯Ø±Ø§Ø³Ø©">
                        <i class="fas fa-graduation-cap"></i> Ø§Ù„Ø¯Ø±Ø§Ø³Ø©
                    </button>
                    <button class="sidebar-item" data-category="Ø£ÙÙƒØ§Ø±">
                        <i class="fas fa-lightbulb"></i> Ø£ÙÙƒØ§Ø±
                    </button>
                    <button class="sidebar-item" data-category="Ù…Ù‡Ù…">
                        <i class="fas fa-star"></i> Ø§Ù„Ù…Ù‡Ù…
                    </button>
                </div>
                <div class="sidebar-footer">
                    <button id="newNoteBtn" class="btn btn-primary btn-block">
                        <i class="fas fa-plus"></i> Ù…Ù„Ø§Ø­Ø¸Ø© Ø¬Ø¯ÙŠØ¯Ø©
                    </button>
                </div>
            </div>

            <div class="main-content">
                <div class="notes-actions">
                    <div class="filter-controls">
                        <div class="filter-group">
                            <label>ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨:</label>
                            <select id="sortBy">
                                <option value="newest">Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹</option>
                                <option value="oldest">Ø§Ù„Ø£Ù‚Ø¯Ù… Ø£ÙˆÙ„Ø§Ù‹</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>ØªØµÙÙŠØ©:</label>
                            <select id="filterCategory">
                                <option value="Ø§Ù„ÙƒÙ„">Ø§Ù„ÙƒÙ„</option>
                                <option value="Ø¹Ø§Ù…">Ø¹Ø§Ù…</option>
                                <option value="Ø¹Ù…Ù„">Ø¹Ù…Ù„</option>
                                <option value="Ø¯Ø±Ø§Ø³Ø©">Ø¯Ø±Ø§Ø³Ø©</option>
                                <option value="Ø£ÙÙƒØ§Ø±">Ø£ÙÙƒØ§Ø±</option>
                                <option value="Ù…Ù‡Ù…">Ù…Ù‡Ù…</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label class="checkbox-container">
                                <input type="checkbox" id="importantOnly"> Ø§Ù„Ù…Ù‡Ù… ÙÙ‚Ø·
                                <span class="checkmark"></span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="notes-grid" id="notesDisplay"></div>

                <div id="emptyState" class="empty-state">
                    <i class="fas fa-book-open"></i>
                    <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§</h3>
                    <p>Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ø§Ø­Ø¸Ø© Ø¬Ø¯ÙŠØ¯Ø© Ø¨Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± Ø¨Ø§Ù„Ø£Ø¹Ù„Ù‰</p>
                    <button id="emptyStateNewNoteBtn" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ø§Ø­Ø¸Ø© Ø¬Ø¯ÙŠØ¯Ø©
                    </button>
                </div>
            </div>
        </div>

        <div class="note-editor" id="noteEditor">
            <div class="editor-header">
                <h3 id="editorTitle">Ù…Ù„Ø§Ø­Ø¸Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
                <button id="closeEditorBtn" class="btn btn-icon">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="editor-body">
                <textarea id="noteInput" placeholder="Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸ØªÙƒ Ù‡Ù†Ø§..."></textarea>
                <div class="editor-footer">
                    <div class="editor-actions">
                        <select id="noteCategory">
                            <option value="Ø¹Ø§Ù…">Ø¹Ø§Ù…</option>
                            <option value="Ø¹Ù…Ù„">Ø¹Ù…Ù„</option>
                            <option value="Ø¯Ø±Ø§Ø³Ø©">Ø¯Ø±Ø§Ø³Ø©</option>
                            <option value="Ø£ÙÙƒØ§Ø±">Ø£ÙÙƒØ§Ø±</option>
                            <option value="Ù…Ù‡Ù…">Ù…Ù‡Ù…</option>
                        </select>
                        <div class="file-upload">
                            <label for="fileInput" class="btn btn-secondary">
                                <i class="fas fa-paperclip"></i> Ø¥Ø±ÙØ§Ù‚ Ù…Ù„Ù
                                <input type="file" id="fileInput" style="display: none;">
                            </label>
                            <span id="fileName"></span>
                        </div>
                    </div>
                    <div class="editor-buttons">
                        <button id="cancelNoteBtn" class="btn btn-secondary">Ø¥Ù„ØºØ§Ø¡</button>
                        <button id="saveNoteBtn" class="btn btn-primary">Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="alertContainer"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
    // =====================
    // ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø¹Ù†Ø§ØµØ±
    // =====================
    const loader = document.getElementById('loader');
    const authSection = document.getElementById('authSection');
    const appSection = document.getElementById('appSection');
    const usernameInput = document.getElementById('usernameInput');
    const passwordInput = document.getElementById('passwordInput');
    const loginBtn = document.getElementById('loginBtn');
    const registerBtn = document.getElementById('registerBtn');
    const authMessage = document.getElementById('authMessage');
    const logoutBtn = document.getElementById('logoutBtn');
    const currentUsername = document.getElementById('currentUsername');
    const toggleThemeBtn = document.getElementById('toggleThemeBtn');
    const toggleThemeBtn2 = document.getElementById('toggleThemeBtn2');
    const sidebarToggle = document.getElementById('sidebarToggle');
    const sidebar = document.getElementById('sidebar');
    const userDropdownBtn = document.getElementById('userDropdownBtn');
    const userDropdownMenu = document.getElementById('userDropdownMenu');
    const newNoteBtn = document.getElementById('newNoteBtn');
    const emptyStateNewNoteBtn = document.getElementById('emptyStateNewNoteBtn');
    const noteEditor = document.getElementById('noteEditor');
    const editorTitle = document.getElementById('editorTitle');
    const noteInput = document.getElementById('noteInput');
    const saveNoteBtn = document.getElementById('saveNoteBtn');
    const cancelNoteBtn = document.getElementById('cancelNoteBtn');
    const closeEditorBtn = document.getElementById('closeEditorBtn');
    const noteCategory = document.getElementById('noteCategory');
    const fileInput = document.getElementById('fileInput');
    const fileName = document.getElementById('fileName');
    const notesDisplay = document.getElementById('notesDisplay');
    const emptyState = document.getElementById('emptyState');
    const filterCategory = document.getElementById('filterCategory');
    const sortBy = document.getElementById('sortBy');
    const importantOnly = document.getElementById('importantOnly');
    const searchInput = document.getElementById('searchInput');
    const sidebarItems = document.querySelectorAll('.sidebar-item');
    const alertContainer = document.getElementById('alertContainer');

    // =====================
    // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    // =====================
    let users = JSON.parse(localStorage.getItem('noteAppUsers')) || [];
    let notes = JSON.parse(localStorage.getItem('noteAppNotes')) || [];
    let currentUser = null;
    let currentNoteId = null;
    let currentFile = null;
    let isDarkMode = localStorage.getItem('noteAppDarkMode') === 'true';

    // =====================
    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    // =====================
    init();

    function init() {
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        loadData();

        // ØªØ·Ø¨ÙŠÙ‚ ÙˆØ¶Ø¹ Ø§Ù„Ø£Ù„ÙˆØ§Ù†
        applyTheme();

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        const loggedInUser = localStorage.getItem('noteAppCurrentUser');
        if (loggedInUser) {
            currentUser = JSON.parse(loggedInUser);
            showApp();
        } else {
            showAuth();
        }

        // Ø¥Ø®ÙØ§Ø¡ loader Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        setTimeout(() => {
            loader.style.opacity = '0';
            setTimeout(() => {
                loader.style.display = 'none';
            }, 300);
        }, 500);
    }

    function loadData() {
        const savedUsers = localStorage.getItem('noteAppUsers');
        const savedNotes = localStorage.getItem('noteAppNotes');
        
        if (savedUsers) users = JSON.parse(savedUsers);
        if (savedNotes) notes = JSON.parse(savedNotes);
    }

    function saveData() {
        localStorage.setItem('noteAppUsers', JSON.stringify(users));
        localStorage.setItem('noteAppNotes', JSON.stringify(notes));
    }

    function showAuth() {
        authSection.style.display = 'flex';
        appSection.style.display = 'none';
    }

    function showApp() {
        authSection.style.display = 'none';
        appSection.style.display = 'block';
        currentUsername.textContent = currentUser.username;
        displayNotes();
    }

    // =====================
    // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¸Ù„Ù…
    // =====================
    function applyTheme() {
        if (isDarkMode) {
            document.body.classList.add('dark-mode');
            toggleThemeBtn.innerHTML = '<i class="fas fa-sun"></i> Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ§ØªØ­';
            toggleThemeBtn2.innerHTML = '<i class="fas fa-sun"></i>';
        } else {
            document.body.classList.remove('dark-mode');
            toggleThemeBtn.innerHTML = '<i class="fas fa-moon"></i> Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¸Ù„Ù…';
            toggleThemeBtn2.innerHTML = '<i class="fas fa-moon"></i>';
        }
    }

    function toggleTheme() {
        isDarkMode = !isDarkMode;
        localStorage.setItem('noteAppDarkMode', isDarkMode);
        applyTheme();
    }

    // =====================
    // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
    // =====================
    function displayNotes() {
        const categoryFilter = filterCategory.value;
        const searchTerm = searchInput.value.toLowerCase();
        const showImportantOnly = importantOnly.checked;
        const sortOrder = sortBy.value;

        let filteredNotes = notes.filter(note => note.userId === currentUser.id);

        // ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„ÙØ¦Ø©
        if (categoryFilter !== 'Ø§Ù„ÙƒÙ„') {
            filteredNotes = filteredNotes.filter(note => note.category === categoryFilter);
        }

        // ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ø¨Ø­Ø«
        if (searchTerm) {
            filteredNotes = filteredNotes.filter(note => 
                note.content.toLowerCase().includes(searchTerm) ||
                (note.fileName && note.fileName.toLowerCase().includes(searchTerm))
            );
        }

        // ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ø£Ù‡Ù…ÙŠØ©
        if (showImportantOnly) {
            filteredNotes = filteredNotes.filter(note => note.category === 'Ù…Ù‡Ù…');
        }

        // ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
        if (sortOrder === 'newest') {
            filteredNotes.sort((a, b) => new Date(b.date) - new Date(a.date));
        } else {
            filteredNotes.sort((a, b) => new Date(a.date) - new Date(b.date));
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
        notesDisplay.innerHTML = '';

        if (filteredNotes.length === 0) {
            emptyState.style.display = 'flex';
        } else {
            emptyState.style.display = 'none';
            filteredNotes.forEach(note => {
                const noteElement = document.createElement('div');
                noteElement.className = `note-card ${note.category.toLowerCase()}`;
                
                let attachmentHtml = '';
                if (note.fileName) {
                    attachmentHtml = `
                        <div class="attachment">
                            <a href="#" data-file="${note.fileName}" class="download-file">
                                <i class="fas fa-paperclip"></i> ${note.fileName}
                            </a>
                        </div>
                    `;
                }

                noteElement.innerHTML = `
                    <div class="note-actions">
                        <button class="edit-btn" data-id="${note.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="delete-btn" data-id="${note.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                        ${note.category !== 'Ù…Ù‡Ù…' ? 
                            `<button class="important-btn" data-id="${note.id}">
                                <i class="fas fa-star"></i>
                            </button>` : ''}
                    </div>
                    <div class="note-content">${note.content}</div>
                    ${attachmentHtml}
                    <div class="note-meta">
                        <span class="note-category">${note.category}</span>
                        <span class="note-date">${formatDate(note.date)}</span>
                    </div>
                `;
                notesDisplay.appendChild(noteElement);
            });
        }

        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        addNoteEvents();
    }

    function formatDate(dateString) {
        const options = { 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric', 
            hour: '2-digit', 
            minute: '2-digit',
            hour12: true
        };
        return new Date(dateString).toLocaleDateString('ar-EG', options);
    }

    function addNoteEvents() {
        // Ø­Ø°Ù Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©
        document.querySelectorAll('.delete-btn').forEach(button => {
            button.addEventListener('click', function() {
                const noteId = parseInt(this.getAttribute('data-id'));
                deleteNote(noteId);
            });
        });

        // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©
        document.querySelectorAll('.edit-btn').forEach(button => {
            button.addEventListener('click', function() {
                const noteId = parseInt(this.getAttribute('data-id'));
                editNote(noteId);
            });
        });

        // ØªØ­Ø¯ÙŠØ¯ ÙƒÙ…Ù„Ø§Ø­Ø¸Ø© Ù…Ù‡Ù…Ø©
        document.querySelectorAll('.important-btn').forEach(button => {
            button.addEventListener('click', function() {
                const noteId = parseInt(this.getAttribute('data-id'));
                markAsImportant(noteId);
            });
        });

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø±ÙÙ‚
        document.querySelectorAll('.download-file').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const fileName = this.getAttribute('data-file');
                showAlert('Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø¥ØµØ¯Ø§Ø±', 'info');
            });
        });
    }

    function openEditor(mode, noteId = null) {
        currentNoteId = noteId;
        
        if (mode === 'add') {
            editorTitle.textContent = 'Ù…Ù„Ø§Ø­Ø¸Ø© Ø¬Ø¯ÙŠØ¯Ø©';
            noteInput.value = '';
            noteCategory.value = 'Ø¹Ø§Ù…';
            fileName.textContent = '';
            currentFile = null;
        } else if (mode === 'edit') {
            const note = notes.find(n => n.id === noteId);
            if (note) {
                editorTitle.textContent = 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©';
                noteInput.value = note.content;
                noteCategory.value = note.category;
                fileName.textContent = note.fileName || '';
                currentFile = note.fileName ? { name: note.fileName } : null;
            }
        }
        
        noteEditor.classList.add('open');
        
        // Ø¶Ø¨Ø· Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ù…Ø­Ø±Ø± Ù„Ù„Ù‡Ø§ØªÙ
        if (isMobileDevice()) {
            adjustEditorHeight();
            
            // ØªØ£Ø®ÙŠØ± Ø§Ù„ØªØ±ÙƒÙŠØ² Ø­ØªÙ‰ ÙŠÙƒØªÙ…Ù„ ÙØªØ­ Ø§Ù„Ù…Ø­Ø±Ø±
            setTimeout(() => {
                noteInput.focus();
                
                // ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø´Ø§Ø´Ø© Ù„Ù„Ø£Ø¹Ù„Ù‰ Ù„Ø±Ø¤ÙŠØ© Ø§Ù„Ù…Ø­Ø±Ø±
                window.scrollTo({
                    top: document.body.scrollHeight,
                    behavior: 'smooth'
                });
            }, 300);
        } else {
            noteInput.focus();
        }
    }

    function closeEditor() {
        noteEditor.classList.remove('open');
    }

    function saveNote() {
        const content = noteInput.value.trim();
        const category = noteCategory.value;
        
        if (!content) {
            showAlert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø­ØªÙˆÙ‰ Ù„Ù„Ù…Ù„Ø§Ø­Ø¸Ø©', 'error');
            return;
        }

        if (currentNoteId) {
            // ØªØ¹Ø¯ÙŠÙ„ Ù…Ù„Ø§Ø­Ø¸Ø© Ù…ÙˆØ¬ÙˆØ¯Ø©
            const noteIndex = notes.findIndex(n => n.id === currentNoteId);
            if (noteIndex !== -1) {
                notes[noteIndex].content = content;
                notes[noteIndex].category = category;
                notes[noteIndex].fileName = currentFile ? currentFile.name : null;
                showAlert('ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
            }
        } else {
            // Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ø§Ø­Ø¸Ø© Ø¬Ø¯ÙŠØ¯Ø©
            const newNote = {
                id: Date.now(),
                userId: currentUser.id,
                content: content,
                category: category,
                date: new Date().toISOString(),
                fileName: currentFile ? currentFile.name : null
            };
            
            notes.unshift(newNote);
            showAlert('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }
        
        saveData();
        displayNotes();
        closeEditor();
    }

    function deleteNote(id) {
        if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©ØŸ')) {
            notes = notes.filter(note => note.id !== id);
            saveData();
            displayNotes();
            showAlert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }
    }

    function editNote(id) {
        openEditor('edit', id);
    }

    function markAsImportant(id) {
        const noteIndex = notes.findIndex(n => n.id === id);
        if (noteIndex !== -1) {
            notes[noteIndex].category = 'Ù…Ù‡Ù…';
            saveData();
            displayNotes();
            showAlert('ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© ÙƒÙ…Ù‡Ù…Ø©', 'success');
        }
    }

    // =====================
    // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø±ÙÙ‚Ø©
    // =====================
    fileInput.addEventListener('change', function() {
        if (this.files.length > 0) {
            currentFile = this.files[0];
            fileName.textContent = currentFile.name;
            showAlert('ØªÙ… Ø¥Ø±ÙØ§Ù‚ Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }
    });

    // =====================
    // Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
    // =====================
    function showAlert(message, type) {
        const alert = document.createElement('div');
        alert.className = `alert alert-${type}`;
        alert.innerHTML = `
            <i class="fas ${type === 'success' ? 'fa-check-circle' : 
                          type === 'error' ? 'fa-exclamation-circle' : 
                          type === 'warning' ? 'fa-exclamation-triangle' : 'fa-info-circle'}"></i>
            ${message}
        `;
        
        alertContainer.appendChild(alert);
        
        // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†ÙŠ
        setTimeout(() => {
            alert.remove();
        }, 3000);
    }

    // =====================
    // Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
    // =====================
    function login() {
        const username = usernameInput.value.trim();
        const password = passwordInput.value.trim();
        
        if (!username || !password) {
            authMessage.textContent = 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±';
            return;
        }

        const user = users.find(u => u.username === username && u.password === password);
        if (user) {
            currentUser = user;
            localStorage.setItem('noteAppCurrentUser', JSON.stringify(user));
            showApp();
            showAlert(`Ù…Ø±Ø­Ø¨Ø§Ù‹ ${username}!`, 'success');
            usernameInput.value = '';
            passwordInput.value = '';
            authMessage.textContent = '';
        } else {
            authMessage.textContent = 'Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©';
        }
    }

    function register() {
        const username = usernameInput.value.trim();
        const password = passwordInput.value.trim();
        
        if (!username || !password) {
            authMessage.textContent = 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±';
            return;
        }

        const userExists = users.some(u => u.username === username);
        if (userExists) {
            authMessage.textContent = 'Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹';
        } else {
            const newUser = {
                id: Date.now(),
                username: username,
                password: password
            };
            
            users.push(newUser);
            saveData();
            authMessage.textContent = 'ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­! ÙŠÙ…ÙƒÙ†Ùƒ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¢Ù†';
            showAlert('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
        }
    }

    function logout() {
        currentUser = null;
        localStorage.removeItem('noteAppCurrentUser');
        showAuth();
        showAlert('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'success');
    }

    // =====================
    // ÙˆØ¸Ø§Ø¦Ù Ù…Ø³Ø§Ø¹Ø¯Ø©
    // =====================
    function isMobileDevice() {
        return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    }

    function adjustEditorHeight() {
        const windowHeight = window.innerHeight;
        const editorMaxHeight = Math.floor(windowHeight * 0.7);
        noteEditor.style.maxHeight = `${editorMaxHeight}px`;
    }

    // =====================
    // Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
    // =====================
    // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¸Ù„Ù…
    toggleThemeBtn.addEventListener('click', toggleTheme);
    toggleThemeBtn2.addEventListener('click', toggleTheme);

    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù„ØªØ³Ø¬ÙŠÙ„
    loginBtn.addEventListener('click', login);
    registerBtn.addEventListener('click', register);
    logoutBtn.addEventListener('click', logout);

    // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
    newNoteBtn.addEventListener('click', () => openEditor('add'));
    emptyStateNewNoteBtn.addEventListener('click', () => openEditor('add'));
    saveNoteBtn.addEventListener('click', saveNote);
    cancelNoteBtn.addEventListener('click', closeEditor);
    closeEditorBtn.addEventListener('click', closeEditor);

    // ØªØµÙÙŠØ© ÙˆØªØ±ØªÙŠØ¨ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
    filterCategory.addEventListener('change', displayNotes);
    sortBy.addEventListener('change', displayNotes);
    importantOnly.addEventListener('change', displayNotes);
    searchInput.addEventListener('input', displayNotes);

    // Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©
    sidebarToggle.addEventListener('click', () => {
        sidebar.classList.toggle('open');
    });

    sidebarItems.forEach(item => {
        item.addEventListener('click', () => {
            sidebarItems.forEach(i => i.classList.remove('active'));
            item.classList.add('active');
            filterCategory.value = item.getAttribute('data-category');
            displayNotes();
            
            // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ù‡ÙˆØ§ØªÙ
            if (isMobileDevice()) {
                sidebar.classList.remove('open');
            }
        });
    });

    // Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
    userDropdownBtn.addEventListener('click', () => {
        userDropdownMenu.style.display = userDropdownMenu.style.display === 'block' ? 'none' : 'block';
    });

    // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
    window.addEventListener('click', (e) => {
        if (!e.target.matches('#userDropdownBtn') && !e.target.closest('#userDropdownMenu')) {
            if (userDropdownMenu.style.display === 'block') {
                userDropdownMenu.style.display = 'none';
            }
        }
        
        if (e.target === noteEditor) {
            closeEditor();
        }
    });

    // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
    if (users.length === 0) {
        users.push({
            id: 1,
            username: 'test',
            password: 'test123'
        });
        saveData();
    }

    // ØªØ­Ø³ÙŠÙ† ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…Ø­Ø±Ø± Ø¨Ø§Ù„Ø²Ø± ESC
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && noteEditor.classList.contains('open')) {
            closeEditor();
        }
    });

    // Ø¶Ø¨Ø· Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø£ÙˆÙ„ÙŠ Ù„Ù„Ù…Ø­Ø±Ø± Ø¹Ù„Ù‰ Ø§Ù„Ù‡ÙˆØ§ØªÙ
    if (isMobileDevice()) {
        adjustEditorHeight();
    }

    // Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ù…Ø­Ø±Ø± Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø­Ø¬Ù… Ø§Ù„Ù†Ø§ÙØ°Ø©
    window.addEventListener('resize', function() {
        if (isMobileDevice() && noteEditor.classList.contains('open')) {
            adjustEditorHeight();
        }
    });
});
    </script>
</body>
</html>
